# ===============================
# assistant/services/faq_handler.py
# ===============================
import logging

logger = logging.getLogger('assistant')


class FAQHandler:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤"""
    
    FAQ_DATA = {
        "–¥–æ—Å—Ç–∞–≤–∫–∞": {
            "keywords": ["–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–∏—Ç—å", "–ø—Ä–∏–≤–µ–∑—Ç–∏", "–∫—É—Ä—å–µ—Ä", "–ø–æ–ª—É—á–∏—Ç—å"],
            "answer": """üöö **–î–æ—Å—Ç–∞–≤–∫–∞:**
            
‚Ä¢ –ü–æ –ê—Å—Ç–∞–Ω–µ: 1-2 –¥–Ω—è, —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç 1000 ‚Ç∏
‚Ä¢ –ü–æ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É: 3-5 –¥–Ω–µ–π, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–≥–∏–æ–Ω–∞
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 50 000 ‚Ç∏
‚Ä¢ –ö—É—Ä—å–µ—Ä –ø–æ–∑–≤–æ–Ω–∏—Ç –∑–∞ —á–∞—Å –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏"""
        },
        "–æ–ø–ª–∞—Ç–∞": {
            "keywords": ["–æ–ø–ª–∞—Ç–∞", "–æ–ø–ª–∞—Ç–∏—Ç—å", "–ø–ª–∞—Ç–∏—Ç—å", "kaspi", "–∫–∞—Ä—Ç–∞", "–Ω–∞–ª–∏—á–Ω—ã–µ"],
            "answer": """üí≥ **–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:**
            
‚Ä¢ –ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π –æ–Ω–ª–∞–π–Ω
‚Ä¢ Kaspi QR / Kaspi –ø–µ—Ä–µ–≤–æ–¥–æ–º
‚Ä¢ –†–∞—Å—Å—Ä–æ—á–∫–∞ 0-0-12 —á–µ—Ä–µ–∑ Kaspi
‚Ä¢ –ö—Ä–µ–¥–∏—Ç –æ—Ç –±–∞–Ω–∫–æ–≤-–ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤"""
        },
        "–≤–æ–∑–≤—Ä–∞—Ç": {
            "keywords": ["–≤–æ–∑–≤—Ä–∞—Ç", "–≤–µ—Ä–Ω—É—Ç—å", "–æ–±–º–µ–Ω", "–æ–±–º–µ–Ω—è—Ç—å", "–Ω–µ –ø–æ–¥–æ—à–µ–ª"],
            "answer": """‚Ü©Ô∏è **–í–æ–∑–≤—Ä–∞—Ç –∏ –æ–±–º–µ–Ω:**
            
‚Ä¢ –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π
‚Ä¢ –¢–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–æ–≤–∞—Ä–Ω–æ–º –≤–∏–¥–µ
‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º —á–µ–∫ –∏ —É–ø–∞–∫–æ–≤–∫–∞
‚Ä¢ –î–µ–Ω—å–≥–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 3-5 –¥–Ω–µ–π
‚Ä¢ –û–±–º–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä –≤ –¥–µ–Ω—å –æ–±—Ä–∞—â–µ–Ω–∏—è"""
        },
        "–≥–∞—Ä–∞–Ω—Ç–∏—è": {
            "keywords": ["–≥–∞—Ä–∞–Ω—Ç–∏—è", "–≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π", "—Å–ª–æ–º–∞–ª—Å—è", "—Ä–µ–º–æ–Ω—Ç"],
            "answer": """‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—è:**
            
‚Ä¢ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
‚Ä¢ –°—Ä–æ–∫ —É–∫–∞–∑–∞–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–æ–±—ã—á–Ω–æ 12-24 –º–µ—Å—è—Ü–∞)
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–º —Ü–µ–Ω—Ç—Ä–µ
‚Ä¢ –ü—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–º–æ–Ω—Ç–∞ - –∑–∞–º–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞"""
        },
        "—Å–∞–º–æ–≤—ã–≤–æ–∑": {
            "keywords": ["—Å–∞–º–æ–≤—ã–≤–æ–∑", "–∑–∞–±—Ä–∞—Ç—å", "–∞–¥—Ä–µ—Å", "–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è", "–º–∞–≥–∞–∑–∏–Ω"],
            "answer": """üìç **–°–∞–º–æ–≤—ã–≤–æ–∑:**
            
–ê–¥—Ä–µ—Å: 
‚Ä¢ –≥. –ê–ª–º–∞—Ç—ã, –ø—Ä–æ—Å–ø–µ–∫—Ç –ê–±—ã–ª–∞–π —Ö–∞–Ω–∞, 7 (–≤—Ö–æ–¥ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —É–ª.–¢—É–∑–æ–≤–∞)
‚Ä¢ –≥. –ê—Å—Ç–∞–Ω–∞, –ø—Ä–æ—Å–ø–µ–∫—Ç –†–µ—Å–ø—É–±–ª–∏–∫–∏, 72 (—Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –†–µ—Å–ø—É–±–ª–∏–∫–∏)
‚Ä¢ –≥. –ü–∞–≤–ª–æ–¥–∞—Ä, —É–ª. –ñ–µ–ª—Ç–æ–∫—Å–∞–Ω, 7 (–±—ã–≤—à–∞—è –í–æ–ª–æ–¥–∞—Ä—Å–∫–æ–≥–æ)

‚Ä¢ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: –ü–ù-–í–° 10:00-20:00
‚Ä¢ –°–∞–º–æ–≤—ã–≤–æ–∑ - –±–µ—Å–ø–ª–∞—Ç–Ω–æ
‚Ä¢ –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä –Ω–∞ 3 –¥–Ω—è
‚Ä¢ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é"""
        },
        "–∫–æ–Ω—Ç–∞–∫—Ç—ã": {
            "keywords": ["–∫–æ–Ω—Ç–∞–∫—Ç—ã", "—Ç–µ–ª–µ—Ñ–æ–Ω", "–ø–æ–∑–≤–æ–Ω–∏—Ç—å", "email", "—Å–≤—è–∑–∞—Ç—å—Å—è"],
            "answer": """üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
            
–¢–µ–ª–µ—Ñ–æ–Ω: +7 771 013-00-20

–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω
+7 771 013-00-20

Kaspi –∑–∞–∫–∞–∑—ã:
+7 775 894-93-84

–≥. –ê–ª–º–∞—Ç—ã,
+7 747 601-03-25 –¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª
+7 7273 51-28-51 –¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª
–≥. –ê—Å—Ç–∞–Ω–∞,
+7 707 956-50-26 –¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª
+7 7172 39-52-80 –¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª
–≥. –ü–∞–≤–ª–æ–¥–∞—Ä
+7 7182 77-70-55 –¢–æ—Ä–≥–æ–≤—ã–π –∑–∞–ª
+7 7182 39-36-89 –°–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä

‚Ä¢ Email: sales@overclockers.kz
‚Ä¢ Instagram: @over.kz
‚Ä¢ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏: 9:00-19:00"""
        },
        "—Ä–∞—Å—Å—Ä–æ—á–∫–∞": {
            "keywords": ["—Ä–∞—Å—Å—Ä–æ—á–∫–∞", "–∫—Ä–µ–¥–∏—Ç", "kaspi —Ä–∞—Å—Å—Ä–æ—á–∫–∞", "–≤ –∫—Ä–µ–¥–∏—Ç"],
            "answer": """üí∞ **–†–∞—Å—Å—Ä–æ—á–∫–∞ –∏ –∫—Ä–µ–¥–∏—Ç:**
            
‚Ä¢ Kaspi —Ä–∞—Å—Å—Ä–æ—á–∫–∞ 0-0-12: –±–µ–∑ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–Ω–æ—Å–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã
"""
        }
    }
    
    @classmethod
    def find_relevant_faq(cls, user_message: str) -> str:
        """–ù–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π FAQ"""
        user_message_lower = user_message.lower()
        
        for topic, data in cls.FAQ_DATA.items():
            if any(keyword in user_message_lower for keyword in data["keywords"]):
                logger.info(f"Found FAQ topic: {topic}")
                return data["answer"]
        
        return ""
    
    @classmethod
    def get_all_faq_context(cls) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç FAQ –¥–ª—è GPT"""
        context = []
        for topic, data in cls.FAQ_DATA.items():
            context.append(f"**{topic.upper()}**:\n{data['answer']}")
        return "\n\n".join(context)
    
    @classmethod
    def is_faq_question(cls, user_message: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–æ–ø—Ä–æ—Å FAQ"""
        user_message_lower = user_message.lower()
        
        faq_indicators = [
            "–∫–∞–∫", "–≥–¥–µ", "–∫–æ–≥–¥–∞", "–º–æ–∂–Ω–æ –ª–∏", "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç",
            "–¥–æ—Å—Ç–∞–≤–∫–∞", "–æ–ø–ª–∞—Ç–∞", "–≤–æ–∑–≤—Ä–∞—Ç", "–≥–∞—Ä–∞–Ω—Ç–∏—è", "–∫–æ–Ω—Ç–∞–∫—Ç"
        ]
        
        return any(indicator in user_message_lower for indicator in faq_indicators)